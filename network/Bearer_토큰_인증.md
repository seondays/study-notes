# Basic 인증과 Bearer 인증의 모든 것
[Basic 인증과 Bearer 인증의 모든 것](https://docs.tosspayments.com/blog/everything-about-basic-bearer-auth#basic-%EC%9D%B8%EC%A6%9D%EA%B3%BC-bearer-%EC%9D%B8%EC%A6%9D%EC%9D%98-%EB%AA%A8%EB%93%A0-%EA%B2%83)
와 참고 자료를 읽고 학습한 문서입니다.

## HTTP 통신 방법
HTTP 통신에서는 보호된 서버의 리소스에 인증된 클라이언트만 접근 가능하도록 인증 정보(Credentials)를 확인하며, 아래와 같은 형식의 인증 헤더를 요청에 사용한다.

`Authorization: <type> <credentials>`

<img width="702" alt="스크린샷 2024-10-12 오후 5 39 02" src="https://github.com/user-attachments/assets/319f0c62-8905-48fb-861e-476d01209296">

1. 인증이 필요한 리소스지만 인증 헤더가 누락되어 있는 경우 서버는 클라이언트에게 `401 Unauthorized`로 응답하며, `WWW-Authenticate` 응답 헤더를 통해 인증 방법에 대해 알린다.
2. 클라이언트는 Authorization 헤더에 적절한 인증 정보를 포함시켜 다시 서버로 요청한다.
3. 만일 인증이 정상적으로 처리되었다면 200 OK 응답이, 그렇지 않다면 `401 Unauthorized` 응답이 반환된다.

> #### 💡 401 Unauthorized vs 403 Forbidden
> 401 Unauthorized  
> 일반적으로 인증되지 않은 상태에서 인증이 필요한 리소스에 접근하거나, 인증이 실패하는 경우의 응답
> 예를 들면, 회원만 글쓰기 가능한 게시판에 비회원이 글쓰기를 요청하는 경우
> 
> 403 Forbidden  
> 인증은 성공했으나, 접근하고자 하는 리소스에 관한 권한이 없어 접근 거부된 경우의 응답 코드
> 예를 들면, 게스트 권한의 회원이 어드민 페이지에 접근하고자 하는 경우

이 때 인증 정보는 인증 방식(type)에 따라 달라질 수 있다. Basic, Bearer, Digest, HOBA 등등이 존재한다.

## Basic 인증
가장 기본적인 인증 방식으로, 인증 정보로 사용자 ID와 패스워드를 사용한다. RFC 7617에 자세한 내용이 기술되어 있다.  

`Authorization: Basic base64({USERNAME}:{PASSWORD})`  

base64로 인코딩한 문자열을 위와 같이 인증 헤더에 담는데, 이는 쉽게 복호화 할 수 있기 때문에 요청에 대한 보안이 보장되지 않는다.
따라서 해당 인증을 사용하기 위해서는 꼭 HTTPS 로 통신해야 한다.

### Basic 인증의 장/단점
#### 장점
- 사용자 ID와 패스워드만 있으면 되므로 간단하다.
- 따라서 단순하고 구축하기 쉽다.

#### 단점
- 서버에서 사용자 목록을 관리해야 하기 때문에, 서버의 부담이 커질 수 있다.
- 사용자 권한을 정교하게 제어 (예를 들어 어드민/일반회원 구분) 하려면 추가적인 구현이 필요하다.

## Bearer 인증
OAuth 2.0 프레임워크에서 사용하는 토큰 인증 방식으로, `Bearer`는 소유자라는 뜻을 가진다. RFC 6750에 자세한 내용이 기술되어 있다.

`Authorization: Bearer <token>`

### OAuth 2.0 프레임워크 [🔗](https://datatracker.ietf.org/doc/html/rfc6749)
제 3자의 클라이언트에게 보호된 리소스를 제한적으로 접근하게 해주는 프레임워크
- 리소스 소유자 : 사용자
- 클라이언트 : 사용자의 정보에 접근하고자 하는 3자 서비스 (예를 들면 내가 개발중인 서버)
- 인가 서버 : 클라이언트의 접근을 관리하는 서버 (리소스 사용자의 허가를 확인하고, 클라이언트에게 엑세스 토큰 발급)
- 리소스 서버 : 리소스 소유자의 데이터를 관리하는 서버 (엑세스 토큰을 받아 리소스 소유자의 정보를 제공)

```
  +--------+                               +---------------+  
  |        |--(A)- Authorization Request ->|   Resource    |  
  |        |                               |     Owner     |  
  |        |<-(B)-- Authorization Grant ---|               |  
  |        |                               +---------------+  
  |        |  
  |        |                               +---------------+  
  |        |--(C)-- Authorization Grant -->| Authorization |  
  | Client |                               |     Server    |  
  |        |<-(D)----- Access Token -------|               |  
  |        |                               +---------------+  
  |        |  
  |        |                               +---------------+  
  |        |--(E)----- Access Token ------>|    Resource   |  
  |        |                               |     Server    |  
  |        |<-(F)--- Protected Resource ---|               |  
  +--------+                               +---------------+  
```

(A) 클라이언트가 리소스 소유자에게 권한 부여(인가)를 요청. 이는 그림처럼 직접 요청할 수도 있고, 중간에 인증서버를 두기도 한다.  
(B) 리소스 소유자가 클라이언트가 리소스에 접근해도 좋다는 허가를 한다. 이는 네 가지 Grant 타입이나, 확장 Grant 타입을 이용하여 진행된다.  
(C) 클라이언트는 해당 허가 권한을 가지고 인가 서버에 엑세스 토큰을 요청  
(D) 인가 서버는 클라이언트가 제시한 권한을 체크한 후 엑세스 토큰 발급  
(E) 클라이언트는 이 엑세스 토큰을 가지고 리소스 소유자의 정보를 관리하는 리소스 서버에 요청  
(F) 리소스 서버는 엑세스 토큰 검증 후 해당하는 리소스를 제공

> #### 💡 인증(Authentication) vs 인가(Authorization)
> Authentication  
> 인증은 사용자의 신원을 검증하는 행위  
> 예를 들어, 아이디와 비밀번호를 통해 해당 사용자인지를 확인하는 것
> 
> Authorization  
> 인가는 사용자에게 특정한 권한을 부여하는 행위
> 일반 사용자에게 관리자라는 권한을 부여하는 것

### Bearer 토큰
OAuth 프레임워크에서 액세스 토큰으로 사용하는 토큰의 유형  
토큰의 형태는 16진수의 문자열, JWT 등등 사용하기 나름이다. 다만 토큰을 외부에서 해석할 수 없어야 하고, 사용자의 중요한 정보를 전달해서는 안 된다.

### Bearer 인증의 장/단점
#### 장점
- 안전하고, 확장이 쉽다.
  - 인코딩을 위한 문자를 서버에서 관리하기 때문에 쉽게 복호화할 수 없다.
  - 서버에서 토큰을 만들 때 유효기간이나 접근 권한을 설정하기 때문에 안전
- 서버가 토큰을 따로 보관할 필요가 없다.

#### 단점
- 토큰이 탈취되는 경우 공격자가 해당 토큰을 가지고 리소스에 접근 가능하다.